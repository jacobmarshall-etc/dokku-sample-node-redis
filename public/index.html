<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
</head>
<body>
    <form id="task-create">
        <input type="text" name="task" placeholder="Create a task">
        <button type="submit">Create</button>
    </form>
    <ul id="tasks">

    </ul>
    <script>
        var $tasks = document.getElementById('tasks'),
            $task = document.getElementById('task'),
            $create = document.getElementById('task-create');

        function renderTask(data) {
            var $li = document.createElement('li');
            $li.innerHTML = '<input type="checkbox"' + (data.checked ? ' checked' : '') +  '> ' + data.task;
            $tasks.appendChild($li);

            return $li;
        }

        function loadTasks() {
            var xhr = new XMLHttpRequest;
            xhr.open('GET', '/tasks', true);

            xhr.addEventListener('load', function () {
                JSON.parse(xhr.responseText).forEach(function (obj) {
                    renderTask(obj);
                });
            });
        }

        $create.addEventListener('submit', function (event) {
            event.preventDefault();

            renderTask({
                task: $task.value
            });

            var xhr = new XMLHttpRequest;
            xhr.open('PUT', '/tasks', true);
            xhr.send(new FormData($create));

            $task.value = '';
        });

        loadTasks();
    </script>
</body>
</html>
